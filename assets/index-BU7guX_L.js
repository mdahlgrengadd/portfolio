import{c as e,g as t,r as n,R as r,G as s,j as a,h as l}from"./index-CEHaoG1y.js";import{an as o,ao as i,ap as c,L as d,t as u,C as m,O as p,h}from"./MacroContext-DUx98eZu.js";import{u as f}from"./fileSystem-B2L0zjH7.js";import{ideSettings as g}from"./esbuild-settings-Bzyyd_qg.js";import{S as x,F as b}from"./settings-CBna9QvL.js";import{F as v}from"./file-DLCHadfa.js";import{F as y}from"./file-text-C78T7yEL.js";import{T as w}from"./trash-2-HD35gx5T.js";import{H as j}from"./house-TvZZ4-Jg.js";import{D as N,P as S}from"./plus-d_e30xhQ.js";import{R as C}from"./refresh-cw-CI727kQA.js";import{U as k}from"./upload-B-ek0tRn.js";import"./monaco-editor-DkIPtwFA.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=e("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),F=e("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]),I=e("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var E={boxFlex:!0,boxFlexGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0};var R=["Webkit","ms","Moz","O"];Object.keys(E).forEach((function(e){R.forEach((function(t){E[function(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}(t,e)]=E[e]}))}));var M=/^ms-/,$=/([A-Z])/g;var O={isUnitlessNumber:E}.isUnitlessNumber,P=function(e){return function(e){return e.replace($,"-$1").toLowerCase()}(e).replace(M,"-ms-")},L=Array.isArray,A=Object.keys,T=/^(normal|none|(\b(url\([^)]*\)|chapter_counter|attr\([^)]*\)|(no-)?(open|close)-quote|inherit)((\b\s*)|$|\s+))+)$/;function B(e,t){return O[e]||"number"!=typeof t?"content"!==e||T.test(t)||(t="'"+t.replace(/'/g,"\\'")+"'"):t+="px",P(e)+": "+t+";  "}const z=t((function(e){var t="";if(!e||0===A(e).length)return t;for(var n=A(e),r=0,s=n.length;r<s;r++){var a=n[r],l=e[a];if(L(l))for(var o=0,i=l.length;o<i;o++)t+=B(a,l[o]);else t+=B(a,l)}return t}));function W(){return W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},W.apply(this,arguments)}const U=["style"],K=n.forwardRef(((e,t)=>{let{style:a={}}=e,l=function(e,t){if(null==e)return{};var n,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)t.indexOf(n=a[r])>=0||(s[n]=e[n]);return s}(e,U);const o=n.useRef(null),i=n.useRef(null),[,c]=n.useState(0);return n.useImperativeHandle(t,(()=>({getBoundingClientRect:()=>{var e;return null==(e=o.current)?void 0:e.getBoundingClientRect()},getParentBoundingClientRect:()=>{var e,t;return null==o||null==(e=o.current)||null==(t=e.parentElement)?void 0:t.getBoundingClientRect()},drawSelectionBox:e=>{requestAnimationFrame((()=>{if(i.current){const t=W({border:"1px solid #4C85D8",background:"rgba(155, 193, 239, 0.4)",position:"absolute",pointerEvents:"none"},a,{top:e.top,left:e.left,width:e.width,height:e.height});i.current.style.cssText=z(t)}}))},clearSelectionBox:()=>{requestAnimationFrame((()=>{i.current&&(i.current.style.cssText=z({top:0,left:0,width:0,height:0}))}))}}))),n.useEffect((()=>{c((e=>e+1))}),[]),r.createElement("div",{ref:o},o.current?s.createPortal(r.createElement("div",W({ref:i},l)),o.current):null)}));function V(e){return(t=e).width*t.height>10;var t}const _=["txt","js","jsx","ts","tsx","md","css","html","json","csv","xml","yml","yaml","py","c","h","cpp","cc","hpp"],G=e=>{try{const t=JSON.parse(e);return t.name&&t.target&&"string"==typeof t.name&&"string"==typeof t.target}catch{return!1}},q=e=>{var t;if("folder"===e.type)return e.name.endsWith(".exe")?a.jsx(x,{className:"w-4 h-4 text-purple-600"}):a.jsx(b,{className:"w-4 h-4 text-blue-500"});switch(null==(t=e.name.split(".").pop())?void 0:t.toLowerCase()){case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"webp":return a.jsx(c,{className:"w-4 h-4 text-green-500"});case"txt":case"doc":case"docx":case"pdf":case"rtf":return a.jsx(y,{className:"w-4 h-4 text-red-500"});case"mp3":case"wav":case"flac":case"ogg":return a.jsx(i,{className:"w-4 h-4 text-purple-500"});case"mp4":case"avi":case"mkv":case"mov":case"wmv":return a.jsx(I,{className:"w-4 h-4 text-orange-500"});case"zip":case"rar":case"7z":case"tar":case"gz":return a.jsx(D,{className:"w-4 h-4 text-yellow-500"});case"js":case"ts":case"html":case"css":case"py":case"java":case"cpp":case"c":case"php":return a.jsx(o,{className:"w-4 h-4 text-cyan-500"});case"json":return(e=>!("file"!==e.type||!e.name.endsWith(".json")||!e.content)&&G(e.content))(e)?a.jsx(x,{className:"w-4 h-4 text-blue-600"}):a.jsx(o,{className:"w-4 h-4 text-cyan-500"});case"exe":case"msi":case"dmg":return a.jsx(x,{className:"w-4 h-4 text-indigo-500"});default:return a.jsx(v,{className:"w-4 h-4 text-gray-500"})}},H=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]},Y=(e,t,n=["root"])=>{if(e.id===t)return n;if(e.children)for(const r of e.children){const e=Y(r,t,[...n,r.id]);if(e)return e}return null},Q=({position:e,itemId:t,onRename:n,onDelete:r,onCreateShortcut:s,setShowContextMenu:l})=>a.jsxs("div",{className:"absolute bg-white border border-gray-200 rounded-lg shadow-xl py-2 z-50 min-w-48",style:{left:e.x,top:e.y},children:[a.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-3 transition-colors",onClick:e=>{e.stopPropagation(),n(t),l(null)},children:[a.jsx(F,{className:"w-4 h-4"}),"Rename"]}),s&&a.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-3 transition-colors",onClick:e=>{e.stopPropagation(),s(t),l(null)},children:[a.jsx(d,{className:"w-4 h-4"}),"Create Desktop Shortcut"]}),a.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center gap-3 text-red-600 hover:bg-red-50 transition-colors",onClick:e=>{e.stopPropagation(),r(t)},children:[a.jsx(w,{className:"w-4 h-4"}),"Delete"]})]}),X=({title:e,inputValue:t,onInputChange:n,onCancel:r,onKeyDown:s,children:l})=>a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:e}),a.jsx("input",{type:"text",value:t,onChange:n,onKeyDown:s,placeholder:"Enter name...",className:"w-full px-3 py-2 border border-gray-300 rounded-md mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),a.jsxs("div",{className:"flex gap-2 justify-end",children:[a.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Cancel"}),l]})]})}),J=({newItemName:e,setNewItemName:t,setShowNewItemDialog:n,createNewItem:r,handleKeyDown:s})=>a.jsxs(X,{title:"Create New Item",inputValue:e,onInputChange:e=>t(e.target.value),onCancel:()=>{n(!1),t("")},onKeyDown:s,children:[a.jsx("button",{onClick:()=>r("folder"),disabled:!e.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Create Folder"}),a.jsx("button",{onClick:()=>r("file"),disabled:!e.trim(),className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Create File"})]}),Z=({newItemName:e,setNewItemName:t,setShowRenameDialog:n,renameItem:r,showRenameDialog:s})=>a.jsx(X,{title:"Rename Item",inputValue:e,onInputChange:e=>t(e.target.value),onCancel:()=>{n(null),t("")},onKeyDown:a=>{"Enter"===a.key&&e.trim()?r(s,e):"Escape"===a.key&&(n(null),t(""))},children:a.jsx("button",{onClick:()=>r(s,e),disabled:!e.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Rename"})}),ee=({items:e,selectedItems:t,setSelectedItems:n,navigateToFolder:s,setShowContextMenu:l,handleDragStart:o,handleFolderDragOver:i,handleFolderDragLeave:c,handleFolderDrop:d,dragOverFolder:u,selectionBox:m,openFile:p})=>a.jsx("div",{className:"mb-8",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"1rem",alignItems:"start"},children:e.map((m=>a.jsx("div",{"data-item-id":m.id,className:`p-3 border rounded-lg cursor-pointer hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 ${t.has(m.id)?"bg-blue-50 border-blue-300 shadow-sm":"border-gray-200"} ${u===m.id?"bg-blue-100 border-blue-400":""}`,onClick:r=>{if(r.stopPropagation(),r.ctrlKey||r.metaKey){const e=new Set(t);e.has(m.id)?e.delete(m.id):e.add(m.id),n(e)}else if(r.shiftKey&&t.size>0){const r=e.map((e=>e.id)),s=Array.from(t).pop(),a=r.indexOf(s||""),l=r.indexOf(m.id);if(a>=0){const e=Math.min(a,l),t=Math.max(a,l),s=r.slice(e,t+1);n(new Set(s))}}else n(new Set([m.id]))},onDoubleClick:e=>{e.stopPropagation(),"folder"===m.type&&m.name.endsWith(".exe")?p&&p(m):"folder"===m.type?s(m.id):"file"===m.type&&p&&p(m)},onContextMenu:e=>{var r;e.preventDefault(),e.stopPropagation(),t.has(m.id)||n(new Set([m.id]));const s=null==(r=e.currentTarget.closest(".h-screen"))?void 0:r.getBoundingClientRect(),a=s?e.clientX-s.left:e.clientX,o=s?e.clientY-s.top:e.clientY;l({x:a,y:o,itemId:m.id})},draggable:!0,onDragStart:e=>o&&o(m.id,e),onDragOver:e=>"folder"===m.type&&i&&i(m.id,e),onDragLeave:()=>"folder"===m.type&&c&&c(),onDrop:e=>"folder"===m.type&&d&&d(m.id,e),children:a.jsxs("div",{className:"flex flex-col items-center text-center",children:[a.jsx("div",{className:"w-12 h-12 flex items-center justify-center mb-2",children:r.cloneElement(q(m),{className:"w-8 h-8 "+(t.has(m.id)?"drop-shadow-sm":"")})}),a.jsx("span",{className:"text-sm truncate w-full font-medium",title:m.name,children:m.name}),"file"===m.type&&void 0!==m.size&&a.jsx("span",{className:"text-xs text-gray-500 mt-1",children:H(m.size)})]})},m.id)))}),te=({fileSystem:e,expandedFolders:t,selectedItems:r,navigateToQuickAccess:s,toggleFolder:l,setSelectedItems:o,handleFolderDragOver:i,handleFolderDragLeave:c,handleFolderDrop:d,dragOverFolder:p})=>{const h=n.useMemo((()=>{var t;return null==(t=e.children)?void 0:t.find((e=>".vfsignore"===e.name&&"file"===e.type))}),[e]),f=n.useMemo((()=>h&&h.content?h.content.split(/\r?\n/).map((e=>e.trim())).filter((e=>e&&!e.startsWith("#"))):[]),[h]),x=n.useMemo((()=>f.map((e=>{const t=e.endsWith("/");let n=(t?e.slice(0,-1):e).replace(/\*\*/g,".*").replace(/\*/g,"[^/]*").replace(/\?/g,".");return t&&(n=`${n}(/.*)?`),new RegExp(`^${n}$`)}))),[f]),v=n.useCallback((e=>e.filter((e=>".vfsignore"!==e.name&&(!(!g.showHiddenFiles&&e.name.startsWith("."))&&!x.some((t=>t.test(e.id)))))).sort(((e,t)=>e.type!==t.type?"folder"===e.type?-1:1:e.name.localeCompare(t.name)))),[x]),y=(e,n=0)=>{const h=t.has(e.id),f=r.has(e.id),g="folder"===e.type&&e.children&&e.children.length>0,x=p===e.id;return a.jsxs("div",{children:[a.jsxs("div",{className:`flex items-center gap-2 py-1 px-2 hover:bg-gray-100 cursor-pointer transition-colors ${f?"bg-blue-100 text-blue-700":""} ${x?"bg-blue-100 border-blue-400":""}`,style:{paddingLeft:20*n+4+"px"},onClick:()=>{"folder"===e.type&&(l(e.id),o(new Set([e.id])))},onDoubleClick:()=>{"folder"===e.type&&s(e.id)},onDragOver:t=>"folder"===e.type&&i&&i(e.id,t),onDragLeave:()=>"folder"===e.type&&c&&c(),onDrop:t=>"folder"===e.type&&d&&d(e.id,t),children:["folder"===e.type&&a.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:g?h?a.jsx(u,{className:"w-3 h-3 text-gray-500"}):a.jsx(m,{className:"w-3 h-3 text-gray-500"}):a.jsx("div",{className:"w-3 h-3"})}),q(e),a.jsx("span",{className:"text-sm truncate flex-1",children:e.name})]}),"folder"===e.type&&h&&e.children&&a.jsx("div",{children:v(e.children).map((e=>y(e,n+1)))})]},e.id)};return a.jsxs("div",{className:"w-64 bg-gray-50 border-r border-gray-200 overflow-y-auto",children:[a.jsxs("div",{className:"p-4",children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-3",children:"Quick Access"}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("button",{onClick:()=>s("desktop"),className:"w-full flex items-center gap-2 px-2 py-1.5 text-sm hover:bg-gray-200 rounded text-left transition-colors",onDragOver:e=>i&&i("desktop",e),onDragLeave:()=>c&&c(),onDrop:e=>d&&d("desktop",e),children:[a.jsx(j,{className:"w-4 h-4 text-blue-500"}),"Desktop"]}),a.jsxs("button",{onClick:()=>s("documents"),className:"w-full flex items-center gap-2 px-2 py-1.5 text-sm hover:bg-gray-200 rounded text-left transition-colors",onDragOver:e=>i&&i("documents",e),onDragLeave:()=>c&&c(),onDrop:e=>d&&d("documents",e),children:[a.jsx(b,{className:"w-4 h-4 text-blue-500"}),"Documents"]}),a.jsxs("button",{onClick:()=>s("downloads"),className:"w-full flex items-center gap-2 px-2 py-1.5 text-sm hover:bg-gray-200 rounded text-left transition-colors",onDragOver:e=>i&&i("downloads",e),onDragLeave:()=>c&&c(),onDrop:e=>d&&d("downloads",e),children:[a.jsx(N,{className:"w-4 h-4 text-blue-500"}),"Downloads"]})]})]}),a.jsxs("div",{className:"px-4 pb-4",children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-3",children:"This PC"}),a.jsx("div",{className:"text-sm",children:y(e)})]})]})},ne=({currentPath:e,breadcrumbs:t,navigateUp:n,navigateToPathLevel:r,showNewItemDialog:s,fileInputRef:l,isAuthenticated:o,handleGithubAuth:i})=>a.jsxs("div",{className:"h-12 bg-gray-50 border-b border-gray-200 flex items-center px-4 gap-2",children:[a.jsx("button",{onClick:n,disabled:e.length<=1,className:"p-2 hover:bg-gray-200 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Go up",children:a.jsx(m,{className:"w-4 h-4 rotate-180"})}),a.jsx("button",{className:"p-2 hover:bg-gray-200 rounded transition-colors",title:"Refresh",children:a.jsx(C,{className:"w-4 h-4"})}),a.jsx("div",{className:"flex-1 mx-4",children:a.jsxs("div",{className:"flex items-center bg-white border border-gray-300 rounded px-3 py-1.5",children:[a.jsx(j,{className:"w-4 h-4 text-gray-400 mr-2"}),a.jsx("button",{onClick:()=>r(0),className:"text-sm hover:text-blue-600 transition-colors",children:"This PC"}),t.map(((e,t)=>a.jsxs("span",{className:"flex items-center",children:[a.jsx(m,{className:"w-3 h-3 text-gray-400 mx-1"}),a.jsx("button",{onClick:()=>r(t+1),className:"text-sm text-gray-600 hover:text-blue-600 transition-colors",children:e.name})]},e.id)))]})}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsxs("button",{onClick:()=>o?s():i(),className:"flex items-center gap-1 px-3 py-1.5 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm transition-colors disabled:opacity-50",title:o?"Create new item":"Sign in to create items",children:[a.jsx(S,{className:"w-4 h-4"}),"New"]}),a.jsx("button",{onClick:()=>{var e;return o?null==(e=l.current)?void 0:e.click():i()},className:"p-2 hover:bg-gray-200 rounded transition-colors",title:o?"Upload files":"Sign in to upload files",children:a.jsx(k,{className:"w-4 h-4"})})]})]}),re=()=>{var e,t;const[s,o]=n.useState(["root"]),[i,c]=n.useState(new Set),[d,u]=n.useState(new Set(["root"])),[m,h]=n.useState(!1),[x,v]=n.useState(null),[y,w]=n.useState(null),[j,N]=n.useState(!1),[S,C]=n.useState(null),[k,D]=n.useState(""),[F,I]=n.useState(null),[E,R]=n.useState(null),[M,$]=n.useState(null),[O,P]=n.useState(!1),[L,A]=n.useState(!1),[T,B]=n.useState(!1),z=n.useRef(null),U=n.useRef(null),G=f((e=>e.fs)),q=f((e=>e.init)),H=f((e=>e.addItems)),X=f((e=>e.renameItem)),re=f((e=>e.deleteItem)),se=f((e=>e.moveItem)),ae=p(),le=n.useMemo((()=>{var e;return null==(e=G.children)?void 0:e.find((e=>".vfsignore"===e.name&&"file"===e.type))}),[G]),oe=n.useMemo((()=>le&&le.content?le.content.split(/\r?\n/).map((e=>e.trim())).filter((e=>e&&!e.startsWith("#"))):[]),[le]),ie=n.useMemo((()=>oe.map((e=>{const t=e.endsWith("/");let n=(t?e.slice(0,-1):e).replace(/\*\*/g,".*").replace(/\*/g,"[^/]*").replace(/\?/g,".");return t&&(n=`${n}(/.*)?`),new RegExp(`^${n}$`)}))),[oe]),ce=n.useMemo((()=>{var e;let t=G;for(let n=1;n<s.length&&(t=null==(e=t.children)?void 0:e.find((e=>e.id===s[n])),t);n++);return((null==t?void 0:t.children)||[]).filter((e=>".vfsignore"!==e.name&&(!(!g.showHiddenFiles&&e.name.startsWith("."))&&!ie.some((t=>t.test(e.id))))))}),[G,s,ie]),de=n.useMemo((()=>[...ce].sort(((e,t)=>e.type!==t.type?"folder"===e.type?-1:1:e.name.localeCompare(t.name)))),[ce]);n.useEffect((()=>{q().then((()=>u(new Set(["root"])))),m||ye()}),[q,m]);const{DragSelection:ue}=function(e){const{onSelectionChange:t,onSelectionEnd:s,onSelectionStart:a,isEnabled:l=!0,selectionProps:o={},eventsElement:i,shouldStartSelecting:c,isValidSelectionStart:d}=e||{},u=n.useRef(null),{cancelCurrentSelection:m}=function({containerRef:e,onSelectionChange:t,onSelectionStart:r,onSelectionEnd:s,isEnabled:a=!0,eventsElement:l,shouldStartSelecting:o,isValidSelectionStart:i=V}){const c=n.useRef(null),d=n.useRef(null),u=n.useRef(!1),m=n.useRef(t),p=n.useRef(r),h=n.useRef(s),f=n.useRef(),g=n.useRef(a);m.current=n.useCallback((e=>{f.current=t?requestAnimationFrame((()=>{t(e)})):void 0}),[t]),p.current=r,h.current=s,g.current=a;const x=n.useCallback((()=>{var t;c.current=null,d.current=null,u.current=!1,null==(t=e.current)||t.clearSelectionBox(),"number"==typeof f.current&&cancelAnimationFrame(f.current)}),[e]),b=n.useCallback(((t,n)=>{var r,s,a;return n||(n=null==(a=e.current)?void 0:a.getParentBoundingClientRect()),{x:t.clientX-("number"==typeof(null==(r=n)?void 0:r.left)?n.left:0),y:t.clientY-("number"==typeof(null==(s=n)?void 0:s.top)?n.top:0)}}),[e]),v=n.useCallback(((t,n)=>{if(c.current&&d.current){if(!n)return;const s=(({startPoint:e,endPoint:t})=>({left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}))({startPoint:c.current,endPoint:d.current}),a=W({},s,{top:s.top+((null==n?void 0:n.top)||0),left:s.left+((null==n?void 0:n.left)||0)});var r;i(s)?(u.current||(null!=p&&p.current&&p.current(t),u.current=!0),null==(r=e.current)||r.drawSelectionBox(s),null==m.current||m.current(a)):u.current&&(null==m.current||m.current(a))}else x()}),[x,e]),y=n.useCallback((t=>{var n;if(!c.current)return;const r=null==(n=e.current)?void 0:n.getParentBoundingClientRect();d.current=b(t,r),v(t,r)}),[v,b,e]),w=n.useCallback((e=>{var t;0===e.button&&(d.current&&(null==h.current||h.current(e)),x(),document.body.style.removeProperty("user-select"),document.body.style.removeProperty("-webkit-user-select"),(l||document.body).removeEventListener("mousemove",y),null==(t=window)||t.removeEventListener("mouseup",w))}),[l,x,y]),j=n.useCallback((e=>{if(0===e.button&&g.current){var t;if("function"==typeof o&&!o(e.target))return;document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",c.current=b(e),(l||document.body).addEventListener("mousemove",y),null==(t=window)||t.addEventListener("mouseup",w)}}),[l,b,y,w]);return n.useEffect((()=>((l||document.body).addEventListener("mousedown",j),()=>{(l||document.body).removeEventListener("mousedown",j),(l||document.body).removeEventListener("mousemove",y),window.removeEventListener("mouseup",w)})),[l,j,y,w]),{cancelCurrentSelection:x}}({containerRef:u,onSelectionEnd:s,onSelectionStart:a,onSelectionChange:t,isEnabled:l,eventsElement:i,shouldStartSelecting:c,isValidSelectionStart:d});return{cancelCurrentSelection:m,DragSelection:n.useCallback((()=>r.createElement(K,W({ref:u},o))),[])}}({onSelectionChange:function(e){if(!U.current||!e.width||!e.height)return;$(e);const t=U.current.querySelectorAll("[data-item-id]"),n=new Set;t.forEach((t=>{const r=t.getBoundingClientRect(),s=t.getAttribute("data-item-id");if(!s)return;const a=U.current.getBoundingClientRect(),l=r.left-a.left,o=r.top-a.top,i=r.right-a.left,c=r.bottom-a.top;!(i<e.left||l>e.left+e.width||c<e.top||o>e.top+e.height)&&n.add(s)})),c(n)},isEnabled:L,shouldStartSelecting:e=>{if(e instanceof HTMLElement){let t=e;for(;t&&t!==U.current;){if(t.hasAttribute("data-item-id"))return!1;t=t.parentElement}return!0}return!1},selectionProps:{style:{border:"2px solid #3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",position:"absolute",zIndex:1e3}}}),me=n.useCallback((e=>{var t;let n=G;for(let r=1;r<e.length;r++){const s=null==(t=n.children)?void 0:t.find((t=>t.id===e[r]));if(!s)return null;n=s}return n}),[G]),pe=n.useCallback((()=>me(s)),[me,s]),he=n.useCallback((e=>{const t=[...s,e];o(t),c(new Set),u((t=>new Set([...t,e])))}),[s]),fe=n.useCallback((()=>{s.length>1&&(o(s.slice(0,-1)),c(new Set))}),[s]),ge=n.useCallback((e=>{const t=s.slice(0,e+1);o(t),c(new Set)}),[s]),xe=n.useCallback((e=>{u((t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}))}),[]),be=n.useCallback((async e=>{if("file"!==e.type&&("folder"!==e.type||!e.name.endsWith(".exe")))return;if("folder"===e.type&&e.name.endsWith(".exe")){try{const t=`app://PublishedApps/${e.name}`;await(null==ae?void 0:ae.executeAction("sys","open",{name:"app-preview",initFromUrl:t})),l(`Opening published app: ${e.name}`)}catch(n){l(`Failed to open ${e.name}`)}return}const t=(e=>{var t;switch(null==(t=e.split(".").pop())?void 0:t.toLowerCase()){case"js":case"jsx":case"ts":case"tsx":case"py":case"css":case"html":case"json":case"xml":case"yml":case"yaml":case"c":case"h":case"cpp":case"cc":case"hpp":case"java":case"php":case"rb":case"go":case"rs":case"swift":case"kt":case"sh":case"bat":case"ps1":return"hybride";case"txt":case"log":case"ini":case"cfg":case"conf":return"notepad";case"md":case"markdown":case"doc":case"docx":case"rtf":return"wordeditor";case"mp3":case"wav":case"flac":case"ogg":case"m4a":case"aac":case"wma":return"audioplayer";case"htm":case"url":return"browser";case"exe":return"app-preview";default:return null}})(e.name);if(t)try{const n=`vfs://${e.id}`;await(null==ae?void 0:ae.executeAction("sys","open",{name:t,initFromUrl:n})),l(`Opening ${e.name} with ${t}`)}catch(n){l(`Failed to open ${e.name}`)}else l(`No default app for file type: ${e.name.split(".").pop()}`)}),[ae]);const ve=e=>{if(!k.trim()||!m)return;const t={id:`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:k.trim(),type:e,..."folder"===e?{children:[]}:{size:0}};H(s,[t]),l.success(("folder"===e?"Folder":"File")+" created"),D(""),N(!1)},ye=()=>{h(!0),v({login:"developer-user",avatar_url:"https://github.com/github.png",name:"Developer User"})},we=(e,t)=>{t.preventDefault(),t.stopPropagation(),E&&E!==e&&(I(e),t.dataTransfer.dropEffect="move")},je=()=>{I(null)},Ne=(e,t)=>{var n,r;if(t.preventDefault(),t.stopPropagation(),I(null),!E||!m)return;if(E===e)return;const a=Y(G,e);if(!a)return;const o="Desktop"===e||a.includes("Desktop")||"Desktop"===a[a.length-1],i=null==(n=null==Se?void 0:Se.children)?void 0:n.find((e=>e.id===E));if(!o&&i&&["test.md","test.txt","package.json","package-lock.json",".vfsignore"].includes(i.name))l.error(`Cannot move system file: ${i.name}`,{description:"Files loaded from the shadow filesystem are protected and cannot be moved. You can copy them to Desktop instead."});else{if(o){const e=null==(r=null==Se?void 0:Se.children)?void 0:r.find((e=>e.id===E));if(e){const t=me(a),n=((e,t)=>{const n=((e,t)=>{const n=t.map((e=>e.name.toLowerCase()));if(!n.includes(e.toLowerCase()))return e;const r=e.lastIndexOf("."),s=r>0?e.substring(0,r):e,a=r>0?e.substring(r):"";let l,o=1;do{l=`${s} (${o})${a}`,o++}while(n.includes(l.toLowerCase()));return l})(e.name,t);return{...e,id:`desktop_copy_${e.id}_${Date.now()}`,name:n}})(e,(null==t?void 0:t.children)||[]);H(a,[n]),l.success(`Copied to Desktop as ${n.name}`)}}else se(s,E,a);R(null)}},Se=pe(),Ce=s.slice(1).reduce(((e,t,n)=>{const r=s.slice(0,n+2),a=me(r);return a&&e.push({id:t,name:a.name,path:r}),e}),[]);return a.jsxs("div",{className:"h-screen flex flex-col bg-white relative",onClick:()=>{w(null)},children:[a.jsx(ne,{currentPath:s,breadcrumbs:Ce,navigateUp:fe,navigateToPathLevel:ge,showNewItemDialog:()=>N(!0),fileInputRef:z,isAuthenticated:m,handleGithubAuth:ye}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsx(te,{fileSystem:G,expandedFolders:d,selectedItems:i,navigateToQuickAccess:e=>{const t=Y(G,e);t&&(o(t),c(new Set))},toggleFolder:xe,setSelectedItems:c,handleFolderDragOver:we,handleFolderDragLeave:je,handleFolderDrop:Ne,dragOverFolder:F}),a.jsxs("div",{className:"flex-1 p-6 overflow-y-auto bg-white transition-colors duration-200 relative border-2 border-dashed "+(T?"border-blue-400 bg-blue-50":"border-transparent"),onDragEnter:e=>{e.preventDefault(),B(!0)},onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy",B(!0)},onDragLeave:e=>{e.preventDefault(),B(!1)},onDrop:async e=>{var t;e.preventDefault(),B(!1);const n=Array.from(e.dataTransfer.files);if(n.length>0&&!m&&(ye(),l.success("Auto-authenticated for file upload")),n.length>0)try{const e=[];for(const r of n){const n=(null==(t=r.name.split(".").pop())?void 0:t.toLowerCase())??"";let s;s=_.includes(n)?await new Promise(((e,t)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=()=>t(n.error),n.readAsText(r)})):"[Binary file content]",e.push({id:`file_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,name:r.name,type:"file",size:r.size,content:s})}H(s,e),l.success(`${e.length} file(s) uploaded`)}catch(r){l.error("Failed to upload files")}},onMouseDown:e=>{if(e.target===U.current||e.target===e.currentTarget)A(!0);else{let t=e.target,n=!1;for(;t&&t!==U.current;){if(t.hasAttribute("data-item-id")){n=!0;break}t=t.parentElement}n||A(!0)}P(!0)},onMouseUp:()=>{P(!1),A(!1),$(null)},ref:U,children:[a.jsx(ue,{}),Se&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-1",children:Se.name}),a.jsxs("p",{className:"text-sm text-gray-500",children:[(null==(e=Se.children)?void 0:e.length)||0," item",1!==((null==(t=Se.children)?void 0:t.length)||0)?"s":""]})]}),de.length>0?a.jsx(ee,{items:de,selectedItems:i,setSelectedItems:c,navigateToFolder:he,setShowContextMenu:w,handleDragStart:(e,t)=>{t.stopPropagation(),m&&(R(e),t.dataTransfer.setData("text/plain",e),t.dataTransfer.setData("application/vfs-item",JSON.stringify({itemId:e,currentPath:s,action:"copy"})),t.dataTransfer.effectAllowed="copyMove",i.has(e)||c(new Set([e])))},handleFolderDragOver:we,handleFolderDragLeave:je,handleFolderDrop:Ne,dragOverFolder:F,selectionBox:M,openFile:be}):a.jsxs("div",{className:"text-center text-gray-500 mb-8",children:[a.jsx(b,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"This folder is empty"})]})]})]})]}),a.jsx("input",{type:"file",ref:z,multiple:!0,className:"hidden",onChange:e=>{Array.from(e.target.files||[])}}),y&&a.jsx(Q,{position:{x:y.x,y:y.y},itemId:y.itemId,onRename:e=>{var t;const n=null==(t=null==Se?void 0:Se.children)?void 0:t.find((t=>t.id===e));n&&(D(n.name),C(e))},onDelete:e=>{var t;if(!m)return;const n=null==(t=null==Se?void 0:Se.children)?void 0:t.find((t=>t.id===e));n&&["Documents","Downloads","Desktop","package.json","package-lock.json",".vfsignore"].includes(n.name)?l.error(`Cannot delete system file: ${n.name}`,{description:"Files loaded from the shadow filesystem are protected and cannot be deleted."}):(re(s,e),l.success("Item deleted"),c(new Set),w(null))},setShowContextMenu:w}),j&&a.jsx(J,{newItemName:k,setNewItemName:D,setShowNewItemDialog:N,createNewItem:ve,handleKeyDown:e=>{"Enter"===e.key&&j&&k.trim()?ve("folder"):"Escape"===e.key&&(N(!1),C(null),w(null))}}),S&&a.jsx(Z,{newItemName:k,setNewItemName:D,setShowRenameDialog:C,renameItem:(e,t)=>{t.trim()&&m&&(X(s,e,t.trim()),l.success("Item renamed"),C(null),D(""))},showRenameDialog:S})]})},se={id:h.id,manifest:h,init:async()=>{},render:()=>a.jsx(re,{}),onOpen:()=>{},onClose:()=>{}};export{se as default};
